name: API Add Known SDK Version

on:
  workflow_dispatch:
    inputs:
      sdk-key:
        description: The SDK key to update (e.g. "flagsmith-python-sdk", "flagsmith-js-sdk")
        required: true
      sdk-version:
        description: The SDK version to add (e.g. "1.2.3")
        required: true

permissions:
  contents: write
  pull-requests: write

jobs:
  add-sdk-version:
    runs-on: depot-ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: 3.11
          cache: "poetry"

      - name: Install Dependencies
        run: make install-packages

      - name: Run `make add-known-sdk-version`
        env:
          opts: --sdk ${{ github.event.inputs.sdk-key }} --version ${{ github.event.inputs.sdk-version }}
        run: make add-known-sdk-version

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          branch: chore/add-sdk-version-${{ github.event.inputs.sdk-key }}-${{ github.event.inputs.sdk-version }}
          title: "chore: Add known SDK version ${{ github.event.inputs.sdk-version }} for ${{ github.event.inputs.sdk-key }}"
          body: |
            This PR adds the known SDK version `${{ github.event.inputs.sdk-version }}` for the SDK key `${{ github.event.inputs.sdk-key }}`.

            If this is incorrect, please update the PR or close it and make the changes manually.
