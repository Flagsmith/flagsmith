<svg viewBox="125 20 825 448" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
  </defs>
  
  <style>
    .box { fill: #ffffff; stroke: #e2e8f0; stroke-width: 2; rx: 8; }
    .box-primary { fill: #f8fafc; stroke: #3b82f6; stroke-width: 2; rx: 8; }
    .box-env { fill: #f0fdf4; stroke: #22c55e; stroke-width: 2; rx: 8; }
    .box-flag { fill: #fefce8; stroke: #eab308; stroke-width: 2; rx: 8; }
    .box-segment { fill: #fff7ed; stroke: #f97316; stroke-width: 2; rx: 8; }
    .box-identity { fill: #eff6ff; stroke: #3b82f6; stroke-width: 2; rx: 8; }
    .box-trait { fill: #fdf2f8; stroke: #ec4899; stroke-width: 2; rx: 8; }
    .box-state { fill: #faf5ff; stroke: #a855f7; stroke-width: 2; rx: 8; }
    .box-seg-override { fill: #fff7ed; stroke: #ea580c; stroke-width: 2; rx: 8; }
    .box-id-override { fill: #eff6ff; stroke: #2563eb; stroke-width: 2; rx: 8; }
    .label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px; fill: #334155; }
    .label-bold { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px; fill: #1e293b; font-weight: 600; }
    .arrow { stroke: #64748b; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead); }
  </style>

  <!-- 
    Layout plan (bottom-up, 170px spacing):
    
    Row 5: Identity Overrides, Traits (children of Identities)
    - 2 items, 170px apart: centers at 630, 800
    - Identities centers above: (630+800)/2 = 715
    
    Row 4: Segment Overrides, Flag States, Identities (children of Env X)
    - Identities must be at 715 (calculated above)
    - Flag States: 715-170 = 545
    - Segment Overrides: 545-170 = 375
    - Centers at: 375, 545, 715
    - Environment X centers above: (375+715)/2 = 545
    
    Row 3: Features, Segments, Environment X, Environment Y
    - Environment X at 545
    - Use 170px spacing between items
    - Segments: 545-170 = 375
    - Features: 375-170 = 205
    - Environment Y: 545+170 = 715
    - Centers at: 205, 375, 545, 715
    
    Row 2: Project A, Project B
    - Project A centers above children: (205+715)/2 = 460
    - Project B: 460+400 = 860
    
    Row 1: Organization
    - Centers above projects: (460+860)/2 = 660
  -->

  <!-- Row 1: Organization (center: 660) -->
  <g filter="url(#shadow)">
    <rect x="585" y="30" width="150" height="44" class="box-primary"/>
    <text x="660" y="57" text-anchor="middle" class="label-bold">Organisation</text>
  </g>

  <!-- Arrows: Organization to Projects (460, 860) -->
  <line x1="660" y1="74" x2="460" y2="110" class="arrow"/>
  <line x1="660" y1="74" x2="860" y2="110" class="arrow"/>

  <!-- Row 2: Projects -->
  <!-- Project A (center: 460) -->
  <g filter="url(#shadow)">
    <rect x="390" y="115" width="140" height="40" class="box"/>
    <text x="460" y="140" text-anchor="middle" class="label-bold">Project A</text>
  </g>

  <!-- Project B (center: 860) -->
  <g filter="url(#shadow)">
    <rect x="790" y="115" width="140" height="40" class="box"/>
    <text x="860" y="140" text-anchor="middle" class="label-bold">Project B</text>
  </g>

  <!-- Arrows: Project A to children (205, 375, 545, 715) -->
  <line x1="460" y1="155" x2="205" y2="195" class="arrow"/>
  <line x1="460" y1="155" x2="375" y2="195" class="arrow"/>
  <line x1="460" y1="155" x2="545" y2="195" class="arrow"/>
  <line x1="460" y1="155" x2="715" y2="195" class="arrow"/>

  <!-- Row 3: Features, Segments, Environment X, Environment Y -->
  <!-- Features (center: 205) -->
  <g filter="url(#shadow)">
    <rect x="153" y="208" width="120" height="40" class="box-flag" opacity="0.6"/>
    <rect x="149" y="204" width="120" height="40" class="box-flag" opacity="0.8"/>
    <rect x="145" y="200" width="120" height="40" class="box-flag"/>
    <text x="205" y="225" text-anchor="middle" class="label">Features</text>
  </g>

  <!-- Segments (center: 375) -->
  <g filter="url(#shadow)">
    <rect x="323" y="208" width="120" height="40" class="box-segment" opacity="0.6"/>
    <rect x="319" y="204" width="120" height="40" class="box-segment" opacity="0.8"/>
    <rect x="315" y="200" width="120" height="40" class="box-segment"/>
    <text x="375" y="225" text-anchor="middle" class="label">Segments</text>
  </g>

  <!-- Environment X (center: 545) -->
  <g filter="url(#shadow)">
    <rect x="475" y="200" width="140" height="40" class="box-env"/>
    <text x="545" y="225" text-anchor="middle" class="label">Environment X</text>
  </g>

  <!-- Environment Y (center: 715) -->
  <g filter="url(#shadow)">
    <rect x="645" y="200" width="140" height="40" class="box-env"/>
    <text x="715" y="225" text-anchor="middle" class="label">Environment Y</text>
  </g>

  <!-- Arrows: Environment X (545) to children (375, 545, 715) -->
  <line x1="545" y1="240" x2="375" y2="295" class="arrow"/>
  <line x1="545" y1="240" x2="545" y2="295" class="arrow"/>
  <line x1="545" y1="240" x2="715" y2="295" class="arrow"/>

  <!-- Row 4: Segment Overrides, Flag States, Identities -->
  <!-- Segment Overrides (center: 375) -->
  <g filter="url(#shadow)">
    <rect x="302" y="308" width="162" height="40" class="box-seg-override" opacity="0.6"/>
    <rect x="298" y="304" width="162" height="40" class="box-seg-override" opacity="0.8"/>
    <rect x="294" y="300" width="162" height="40" class="box-seg-override"/>
    <text x="375" y="325" text-anchor="middle" class="label">Segment Overrides</text>
  </g>

  <!-- Flag States (center: 545) -->
  <g filter="url(#shadow)">
    <rect x="488" y="308" width="130" height="40" class="box-state" opacity="0.6"/>
    <rect x="484" y="304" width="130" height="40" class="box-state" opacity="0.8"/>
    <rect x="480" y="300" width="130" height="40" class="box-state"/>
    <text x="545" y="325" text-anchor="middle" class="label">Flag States</text>
  </g>

  <!-- Identities (center: 715) -->
  <g filter="url(#shadow)">
    <rect x="663" y="308" width="120" height="40" class="box-identity" opacity="0.6"/>
    <rect x="659" y="304" width="120" height="40" class="box-identity" opacity="0.8"/>
    <rect x="655" y="300" width="120" height="40" class="box-identity"/>
    <text x="715" y="325" text-anchor="middle" class="label">Identities</text>
  </g>

  <!-- Arrows: Identities (715) to children (630, 800) -->
  <line x1="715" y1="348" x2="630" y2="405" class="arrow"/>
  <line x1="715" y1="348" x2="800" y2="405" class="arrow"/>

  <!-- Row 5: Identity Overrides, Traits -->
  <!-- Identity Overrides (center: 630) -->
  <g filter="url(#shadow)">
    <rect x="559" y="418" width="158" height="40" class="box-id-override" opacity="0.6"/>
    <rect x="555" y="414" width="158" height="40" class="box-id-override" opacity="0.8"/>
    <rect x="551" y="410" width="158" height="40" class="box-id-override"/>
    <text x="630" y="435" text-anchor="middle" class="label">Identity Overrides</text>
  </g>

  <!-- Traits (center: 800) -->
  <g filter="url(#shadow)">
    <rect x="748" y="418" width="120" height="40" class="box-trait" opacity="0.6"/>
    <rect x="744" y="414" width="120" height="40" class="box-trait" opacity="0.8"/>
    <rect x="740" y="410" width="120" height="40" class="box-trait"/>
    <text x="800" y="435" text-anchor="middle" class="label">Traits</text>
  </g>
</svg>